!function(e,i,t){i.elems={leftSide:"#leftSide",top:"#top",leftSideTrigger:"#leftSideTrigger",btnLogout:"#btn-logout",pageBuffer:"#pageBuffer",module:"#module",alarm:"#alarm",main:"#main",header:"#header",topNavig:"#topNavig",contents:"#contents"};var n=i.elems,o=i.settings.animateDuration;i.cookie={setting:{path:i.path.root},set:function(t){var n=null;console.log("set cookies");for(n in t)e.cookie(n,t[n],i.cookie.setting.path)},removeAll:function(){var t=e.cookie(),n=null;console.log("remove all cookies");for(n in t)e.removeCookie(n,i.cookie.setting.path)}},i.ajax=function(t,n){var o=null,a={url:null,data:null,global:!1,async:!0,cache:!1,dataType:"json",type:"POST",timeout:i.settings.resourceTimeout,buffer:!0,bufferContext:"body",bufferMsg:"处理中",beforeSend:function(){t.buffer&&(o=i.ui.buffer.show({msg:t.bufferMsg,context:t.bufferContext}))},error:function(e,n,a){var l="Ajax过程错误，或联系管理员：\nXMLHttpRequest: "+e+"\ntextStatus: "+n+"\nerrorThrown: "+a;alert(l),console.log(e,n,a),t.buffer&&i.ui.buffer.hide(o)},success:function(e){n(e)},complete:function(){t.buffer&&i.ui.buffer.hide(o)}};return t=e.extend(a,t),n=n||"undefined"!=typeof n?n:function(){},t.url?void e.ajax(t):void alert("app.ajax()，请配置url")},i.ui={init:function(){console.log("initialize"),e(".ui.accordion").accordion(),e(".ui.dropdown").dropdown(),e(".ui-popup").popup({inline:!1,exclusive:!0,className:{popup:"ui inverted mini popup"}}),e(".ui.checkbox").checkbox(),e(".ui-datapicker").datetimepicker({lang:"zh",timepicker:!1,format:"Y/m/d",closeOnDateSelect:!0,closeOnWithoutClick:!0,defaultSelect:!1,mask:!1,scrollInput:!1,scrollMonth:!1})},response:function(){var o=e(t).width();o>960?(console.log("response: medium"),e(n.leftSide).addClass("large").removeClass("small labeled icon"),e(".ui.table").removeClass("very compact small"),e(n.top).find(".header").html(i.info.fullTitle)):960>=o&&o>680?(console.log("response: small"),e(n.leftSide).addClass("small").removeClass("large labeled icon"),e(".ui.table").addClass("small").remove("very compact"),e(n.top).find(".header").html(i.info.title)):680>=o&&(console.log("response: tiny"),e(n.leftSide).addClass("labeled icon").removeClass("small large"),e(".ui.table").addClass("very compact small"),e(n.top).find(".header").html(i.info.sortTitle)),i.ui.sidebar(n.leftSide)},draw:function(i){console.warn("draw");var t=e("body").outerWidth(),a=void 0!==i?i:e(n.leftSide).sidebar("is visible"),l=a?e(n.leftSide).outerWidth():0;e(n.top).stop(!1,!0).animate({width:t-l+"px"},o,function(){e(n.main).stop(!1,!0).animate({"padding-top":e(n.top).outerHeight()+"px"},o)}),e(n.main).stop(!1,!0).animate({"margin-right":l+"px"},o,function(){a?e(n.top).removeClass("inverted"):e(n.top).addClass("inverted")})},buffer:{show:function(i){var t={html:'<div class="ui dimmer">	<div class="ui text loader"></div></div>',context:"body",msg:"处理中",size:"medium",inverted:!1,closable:!1,duration:o,opacity:.7};i=e.extend(t,i);var n=e(i.html),a=n.find(".ui.loader");return i.inverted&&n.addClass("inverted"),a.addClass(i.size).html(i.msg),e(i.context).append(n),n.dimmer({closable:i.closable,duration:{show:i.duration,hide:i.duration},opacity:i.opacity}),n.dimmer("show"),console.log(i.msg),n},hide:function(n){e(n).dimmer("hide");var o=e(n).dimmer("get duration");t.setTimeout(function(){n.remove(),i.ui.draw()},o)}},navigBuild:function(t){for(var a=e(n.leftSide),l=null,s=null,d="",c=null,u=null,f=e.cookie("currentNavigID");t.length;)c=t.splice(0,1)[0],d+='<a class="item" href="'+c.href+'" data-intro="'+c.intro+'" data-icon="'+c.icon+'" data-pid="'+c.pid+'" data-id="'+c.id+'"><i class="icon '+c.icon+'"></i>'+c.text+"</a>";s=e(d),a.html(s.filter("[data-pid=0]")),l=a.find(".item"),function(){for(var i=0,t=l.length;t>i;i+=1){var n=l.eq(i).attr("data-id"),o=s.filter("[data-pid="+n+"]"),a=o.length,r=e('<div class="menu"></div>');a&&(o.appendTo(r),r.insertAfter(l[i]))}}(),l=a.find(".item"),u=l.filter('[data-id="'+f+'"]'),l.on("click",function(t){t.preventDefault();var r=e(this).attr("href"),d=e(this).attr("data-id"),c=e(this).attr("data-icon"),u=e(this).text(),f=e(this).attr("data-intro"),m=e(this);a.find(".menu").stop(!1,!0).slideUp(o),m.next(".menu").stop(!1,!0).slideDown(o,function(){e("body").visibility("refresh")}),r&&"#"!==r&&(i.cookie.set({currentNavigID:d}),e(n.header).find(".header").html(c&&"undefined"!==c?'<i class="'+c+' icon"></i>'+u:u),e(n.header).find(".intro").html("&nbsp;"+f),function(){var i=m.attr("data-id"),t=s.filter("[data-pid="+i+"]"),o=t.length;console.log("tabs:",o),o?(t.find(".icon").hide(),e(n.topNavig).html(t).show()):e(n.topNavig).empty().hide()}(),l.removeClass("active"),m.addClass("active"),m.parent(".menu").stop(!1,!0).show(),i.ui.loadModule({obj:n.contents,href:r,bufferContext:n.main,success:function(){i.ui.tabNavig()}}))}),console.warn("currentNavigID in cookie:",f),f&&0!==u.length?u.click():l.first().click()},tabNavig:function(){var t=e(n.topNavig),o=parseInt(e.cookie("currentTabNavigID"),10),a=t.find(".item"),l=a.filter('[data-id="'+o+'"]');a.on("click",function(t){t.preventDefault();var o=e(this).attr("href"),l=e(this).attr("data-id"),s=e(this);o&&"#"!==o&&(i.cookie.set({currentTabNavigID:l}),a.removeClass("active"),s.addClass("active"),i.ui.loadModule({obj:n.contents,href:o,bufferContext:n.main}))}),console.warn("currentTabNavigID in cookie:",o),o&&0!==l.length?l.click():a.first().click()},loadModule:function(o){var a={obj:n.module,href:"/",bufferContext:"body",success:function(){}};o=e.extend(a,o),e(t).scrollTop(0),e(o.obj).empty(),e(".ui.dimmer.modals").remove(),e(".ui-datapicker").datetimepicker("destroy"),e(t).off("resize.xdsoft"),e(".xdsoft_datetimepicker").remove(),i.ajax({dataType:"html",type:"GET",bufferContext:o.bufferContext,url:o.href},function(t){console.warn("loading href:",o.href),e(o.obj).html(t),o.success(),i.ui.init()})},sidebar:function(t,a){var l={context:"body",transition:"push",dimPage:!1,closable:!1,duration:o,selector:{pusher:n.main},onVisible:function(){e(n.leftSideTrigger).find(".icon").removeClass("indent").addClass("outdent"),i.ui.draw(!0)},onHide:function(){e(n.leftSideTrigger).find(".icon").addClass("indent").removeClass("outdent"),i.ui.draw(!1)},onChange:function(){e(".ui-popup").popup("hide all")}};a=e.extend(l,a),e(t).sidebar(a),e(n.leftSide).sidebar("is visible")&&e(t).sidebar("push page")},modal:function(t){var n=null,a={icon:"help",title:"title",msg:"msg",style:{basic:"",header:"left aligned",content:"left aligned",actions:"right aligned",buttons:""},buttons:[],allowMultiple:!1,context:"body",closeBtn:!1,closable:!1,transition:"scale",blurring:!0,duration:o,selector:{approve:".actions .approve",deny:".actions .deny",close:".actions .close,.ui-dialog-close"},dimmerSettings:{opacity:.7,onChange:function(){i.ui.draw()}},onHidden:function(){t.allowMultiple||n.remove()},html:'<div class="ui coupled modal">	<i class="close icon ui-dialog-close"></i>	<div class="header"></div>	<div class="content"></div>	<div class="actions"></div></div>'};t=e.extend(a,t),n=e(t.html),t.icon&&n.children(".header").prepend('<i class="'+t.icon+' icon"></i>'),t.blurring||e(t.context).removeClass("blurring"),t.closeBtn||n.find(".ui-dialog-close").hide(),n.addClass(t.style.basic),n.children(".header").first().addClass(t.style.header).append(t.title),n.children(".content").first().addClass(t.style.content).append(t.msg),n.children(".actions").first().addClass(t.style.actions);for(var l=0,s=t.buttons.length;s>l;l+=1)n.find(".actions").append(e(t.buttons[l]).addClass(t.style.buttons));return n.modal(t),n},confirm:function(t){var n=null,o={title:"确认",msg:"是否？",icon:"help",allowMultiple:!1,style:{basic:"small",header:"left aligned",content:"center aligned",actions:"right aligned",buttons:""},buttons:['<button class="ui green button approve"><i class="checkmark icon"></i>同意</button>','<button class="ui red button deny"><i class="remove icon"></i>拒绝</button>'],onApprove:function(){},onDeny:function(){}};t=e.extend(o,t),n=i.ui.modal(t),n.modal("show")},alert:function(t){var n=null,o={title:"提示",msg:"提示！",icon:"info",allowMultiple:!1,style:{basic:"small",header:"left aligned",content:"center aligned",actions:"right aligned",buttons:""},buttons:['<button class="ui green button approve"><i class="checkmark icon"></i>好</button>'],onApprove:function(){},onDeny:function(){}};t=e.extend(o,t),n=i.ui.modal(t),n.modal("show")},dialog:function(t,n){var a={style:{basic:"small",header:"left aligned",content:"left aligned",actions:"right aligned"},allowMultiple:!0,context:"body",closeBtn:!0,closable:!1,transition:"scale",blurring:!1,duration:o,selector:{approve:".actions .approve",deny:".actions .deny",close:".actions .close,.ui-dialog-close"},dimmerSettings:{opacity:.6,onChange:function(){i.ui.draw()}},onHidden:function(){n.allowMultiple||e(t).remove()},onApprove:function(){},onDeny:function(){}};return n=e.extend(a,n),n.blurring||e(n.context).removeClass("blurring"),n.closeBtn||t.find(".ui-dialog-close").hide(),e(t).addClass(n.style.basic),e(t).children(".header").first().addClass(n.style.header),e(t).children(".content").first().addClass(n.style.content),e(t).children(".actions").first().addClass(n.style.actions),e(t).modal(n),e(t).modal("show"),e(t)},message:function(t){var o={type:"info",size:"small",msg:"消息",closeBtn:!0,icon:"smile",html:'<div class="ui icon hidden message">	<i class="close icon ui-message-close"></i>	<div class="content"></div></div>',context:n.module};t=e.extend(o,t);var a=e(t.html).addClass(t.type),l=a.find(".ui-message-close");t.closeBtn?l.on("click",function(){a.transition("fade up",function(){a.remove(),i.ui.draw()})}):l.hide(),t.icon&&a.prepend('<i class="'+t.icon+' icon"></i>'),a.find(".content").html(t.msg),e(t.context).prepend(a),a.transition("fade down",function(){i.ui.draw()})},datagrid:function(i,t){var n={searching:!1,lengthChange:!1,ordering:!0,paging:!0,processing:!0,stateSave:!1,serverSide:!1,classes:{}};t=e.extend(n,t),e.extend(e.fn.dataTableExt.oStdClasses,n.classes),e(i).DataTable(t)}},e(function(){i.ui.init(),e("body").visibility({once:!0,continuous:!1,checkOnRefresh:!0,onRefresh:function(){i.ui.response(),i.ui.draw()}}),e("body").visibility("refresh"),e(n.leftSide).sidebar("show"),e(n.btnLogout).off("click.logout").on("click.logout",function(){i.ui.confirm({title:"",msg:"是否退出系统？",icon:"huge help circle",style:{basic:"basic small",header:"center aligned",content:"center aligned",actions:"center aligned",buttons:"inverted"},onApprove:function(){i.cookie.removeAll(),alert("退出！")}})}),e(n.leftSideTrigger).off("click.leftsidetrigger").on("click.leftsidetrigger",function(){e(n.leftSide).sidebar("toggle")}),i.ui.navigBuild(i.settings.menuItems),e(n.pageBuffer).transition("fade out",function(){e(n.pageBuffer).remove(),e("body").removeClass("dimmed"),i.ui.draw()})})}(jQuery,app,window);